# Create a library called "libgfrave" which includes the source files given in
# the array .
# The extension is already found.  Any number of sources could be listed here.

cmake_minimum_required(VERSION 2.8)

#check for ENV variables that are needed
IF(NOT DEFINED ENV{RAVEPATH})
   MESSAGE(FATAL_ERROR "You did not define the environment variable RAVEPATH which is needed to find rave. GFRave will not be built.") 
ENDIF(NOT DEFINED ENV{RAVEPATH})  
SET(RAVEPATH $ENV{RAVEPATH})

IF(NOT DEFINED ENV{ROOTSYS})
   MESSAGE(FATAL_ERROR "You did not set the environment variable ROOTSYS. Please check your ROOT configuration.") 
ENDIF(NOT DEFINED ENV{ROOTSYS})


# get compiler flags from rave
INCLUDE(FindPkgConfig)
SET(ENV{PKG_CONFIG_PATH} ${RAVEPATH})
pkg_search_module(RAVE rave REQUIRED)

# turn comma separated lists into space separated strings
string (REPLACE ";" " " RAVE_LDFLAGS_STR "${RAVE_LDFLAGS}")
string (REPLACE ";" " " RAVE_INCLUDE_DIRS_STR "${RAVE_INCLUDE_DIRS}")
string (REPLACE ";" " " RAVE_CFLAGS_STR "${RAVE_CFLAGS}")

SET (CMAKE_CXX_FLAGS ${RAVE_CFLAGS_STR})


INCLUDE_DIRECTORIES(
  $ENV{ROOTSYS}/include  
  ${CMAKE_SOURCE_DIR}/genfit
  ${CMAKE_SOURCE_DIR}/GenfitTools/GFRave
  ${CLHEP_INCLUDE_DIR}
  ${RAVE_INCLUDE_DIRS_STR}
)

LINK_DIRECTORIES(
	${ROOT_LIBRARY_DIR}
	$ENV{RAVELIBPATH}
)


set(GFRAVE_SRCS 
	GFRaveConverters.cxx  
	GFRaveMagneticField.cxx  
	GFRavePropagator.cxx  
	GFRaveTrackParameters.cxx
	GFRaveVertex.cxx
	GFRaveVertexFactory.cxx
)

set(GFRAVEDICT_HEADERS 
	GFRaveTrackParameters.h
	GFRaveVertex.h
)

string (REPLACE ".h" ".cxx" GFRAVE_HEADERS "${GFRAVE_SRCS}")

if(RULE_CHECKER_FOUND)
    CHECK_RULES("${GFRAVE_SRCS}" "${INCLUDE_DIRECTORIES}" GFRAVE_RULES)
endif(RULE_CHECKER_FOUND)


set(GFRAVE_LINKDEF  GFRaveLinkDef.h)
set(GFRAVE_DICTIONARY ${CMAKE_CURRENT_BINARY_DIR}/GFRaveDict.cxx) 
ROOT_GENERATE_DICTIONARY("${GFRAVEDICT_HEADERS}" "${GFRAVE_LINKDEF}" "${GFRAVE_DICTIONARY}" "${INCLUDE_DIRECTORIES}")

SET(GFRAVE_SRCS_ALL ${GFRAVE_SRCS} ${GFRAVE_DICTIONARY})

string (REPLACE " " " -I" RAVE_INCLUDE_DIRS_I "${RAVE_INCLUDE_DIRS_STR}")

add_library(gfrave SHARED ${GFRAVE_SRCS_ALL})
target_link_libraries(gfrave 
	${ROOT_LIBRARIES}
  ${RAVE_LDFLAGS_STR}
  -I${RAVE_INCLUDE_DIRS_I}
)
set_target_properties(gfrave PROPERTIES ${FAIRROOT_LIBRARY_PROPERTIES})
################ install ###################
install(TARGETS gfrave DESTINATION ${CMAKE_BINARY_DIR}/lib)

