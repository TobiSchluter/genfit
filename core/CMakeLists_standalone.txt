cmake_minimum_required(VERSION 2.6)

#check for ENV variables that are needed
FIND_PROGRAM(ROOT_CONFIG root-config $ENV{ROOTSYS}/bin)

IF(ROOT_CONFIG MATCHES "ROOT_CONFIG-NOTFOUND")
  MESSAGE(FATAL_ERROR "Could not find root-config executable.")
ENDIF(ROOT_CONFIG MATCHES "ROOT_CONFIG-NOTFOUND")

Execute_process(COMMAND ${ROOT_CONFIG} --cflags
	OUTPUT_VARIABLE ROOT_CFLAGS
    	OUTPUT_STRIP_TRAILING_WHITESPACE)

INCLUDE_DIRECTORIES(${GENFIT}/core)

set(GENFIT_SRCS 
	GFAbsFitter.cxx
	GFAbsTrackRep.cxx 
	GFBookkeeping.cxx
	GFDetPlane.cxx 
	GFException.cxx 
	GFKalman.cxx 
	GFRecoHitFactory.cxx 
	GFRecoHitProducer.cxx 
	GFTools.cxx 
	GFTrackCand.cxx 
	GFTrackCandHit.cxx  
	GFTrack.cxx 
	GFConstField.cxx 
	GFFieldManager.cxx
	GFAbsFinitePlane.cxx 
	GFRectFinitePlane.cxx
	GFDaf.cxx 
	GFTrackProximity.cxx
	RecoHits/GFAbsPlanarHit.cxx 
	RecoHits/GFAbsProlateSpacepointHit.cxx
	RecoHits/GFAbsRecoHit.cxx
	RecoHits/GFAbsSpacepointHit.cxx
	RecoHits/GFAbsWireHit.cxx
	RecoHits/GFAbsWirepointHit.cxx 
	RecoHits/GFDafHit.cxx
	RecoHits/GFDafWireHit.cxx
)

set(GENFIT_HEADERS  
  GFAbsFitter.h
	GFAbsTrackRep.h 
	GFBookkeeping.h
	GFDetPlane.h 
	GFException.h 
	GFKalman.h 
	GFRecoHitFactory.h 
	GFRecoHitProducer.h 
	GFTools.h 
	GFTrackCand.h 
	GFTrackCandHit.h  
	GFTrack.h 
	GFConstField.h 
	GFFieldManager.h
	GFAbsFinitePlane.h 
	GFRectFinitePlane.h
	GFDaf.h 
	GFTrackProximity.h
	RecoHits/GFAbsPlanarHit.h 
	RecoHits/GFAbsProlateSpacepointHit.h
	RecoHits/GFAbsRecoHit.h
	RecoHits/GFAbsSpacepointHit.h
	RecoHits/GFAbsWireHit.h
	RecoHits/GFAbsWirepointHit.h 
	RecoHits/GFDafHit.h
	RecoHits/GFDafWireHit.h
)

set(GENFIT_LINKDEF  genfitLinkDef.h)
set(GENFIT_DICTIONARY genfitDict.cxx) 

FIND_PROGRAM(ROOT_CINT_EXECUTABLE
	NAMES rootcint
	PATHS $ENV{ROOTSYS}/bin)

ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_BINARY_DIR}/${GENFIT_DICTIONARY}
	COMMAND ${ROOT_CINT_EXECUTABLE}
      	ARGS -f ${CMAKE_BINARY_DIR}/${GENFIT_DICTIONARY} -c -DHAVE_CONFIG_H
      	-I${GENFIT}/core ${GENFIT_HEADERS} ${GENFIT_LINKDEF}
      	DEPENDS ${GENFIT_HEADERS} ${GENFIT_LINKDEF})
      	
message(${CMAKE_BINARY_DIR}/${GENFIT_DICTIONARY})

SET(GENFIT_SRCS ${GENFIT_SRCS} ${CMAKE_BINARY_DIR}/${GENFIT_DICTIONARY})
#SET(GENFIT_SRCS ${GENFIT_SRCS} ${GENFIT_DICTIONARY})

################ install ###################

#add ROOT lib
Execute_process(COMMAND root-config --glibs --cflags
	OUTPUT_VARIABLE ROOT_LIBS
    	OUTPUT_STRIP_TRAILING_WHITESPACE)



ADD_LIBRARY(genfit SHARED ${GENFIT_SRCS})
TARGET_LINK_LIBRARIES(genfit ${ROOT_LIBS}  -lGeom -lVMC -lEG)

INSTALL(TARGETS genfit DESTINATION ${GENFITLIBINSTALLDIR})

